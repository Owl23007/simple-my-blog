---
title: ç¬¬äº”ç«  ç»“æ„å‹è®¾è®¡æ¨¡å¼
date: 2025-11-19
description: è¯¦ç»†ä»‹ç»ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼ŒåŒ…æ‹¬é€‚é…å™¨æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆæ¨¡å¼å’Œè£…é¥°æ¨¡å¼ã€‚
outline: 2
---

# ç¬¬äº”ç«  ç»“æ„å‹è®¾è®¡æ¨¡å¼

ç»“æ„å‹è®¾è®¡æ¨¡å¼å…³æ³¨**å¦‚ä½•ç»„åˆç±»å’Œå¯¹è±¡**ï¼Œä»¥å½¢æˆæ›´å¤§çš„ç»“æ„ï¼ŒåŒæ—¶ä¿æŒç»“æ„çš„çµæ´»æ€§å’Œé«˜æ•ˆæ€§ã€‚å®ƒä»¬é€šè¿‡ç»§æ‰¿æˆ–ç»„åˆçš„æ–¹å¼ï¼Œè§£å†³æ¥å£é€‚é…ã€èŒè´£æ‰©å±•ã€å±‚æ¬¡æ„å»ºç­‰é—®é¢˜ã€‚

æœ¬ç« æ¶µç›–ä»¥ä¸‹å››ç§æ ¸å¿ƒç»“æ„å‹æ¨¡å¼ï¼ˆGoFï¼‰ï¼š

- é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰
- æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰
- ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰
- è£…é¥°æ¨¡å¼ï¼ˆDecoratorï¼‰

## 5.1 é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰

### å®šä¹‰

å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬**ä¸å…¼å®¹çš„ç±»å¯ä»¥ååŒå·¥ä½œ**ã€‚

### æ ¸å¿ƒæ€æƒ³

> â€œåŒ…è£…ä¸€ä¸ªç±»ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒå¦ä¸€ä¸ªç±»ã€‚â€

### ä¸¤ç§å®ç°æ–¹å¼

| ç±»å‹ | æè¿° | é€‚ç”¨åœºæ™¯ |
|------|------|--------|
| **ç±»é€‚é…å™¨** | é€šè¿‡å¤šé‡ç»§æ‰¿ï¼ˆJava ä¸æ”¯æŒï¼‰å®ç° | ä¸€èˆ¬ä¸ç”¨äº Java |
| **å¯¹è±¡é€‚é…å™¨** | **é€šè¿‡ç»„åˆ**ï¼ˆæŒæœ‰è¢«é€‚é…å¯¹è±¡ï¼‰ | Java ä¸­çš„æ ‡å‡†å®ç°æ–¹å¼ |

### Java ç¤ºä¾‹ï¼šå¯¹è±¡é€‚é…å™¨

å‡è®¾æœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹æ—¥å¿—åº“åªæä¾› `LegacyLogger.log(String)`ï¼Œä½†æˆ‘ä»¬çš„ç³»ç»ŸæœŸæœ›ä½¿ç”¨ `Logger.info(String)` æ¥å£ï¼š

```java
// ç›®æ ‡æ¥å£ï¼ˆæˆ‘ä»¬æœŸæœ›çš„ï¼‰
interface Logger {
    void info(String message);
    void error(String message);
}

// ç¬¬ä¸‰æ–¹ç±»ï¼ˆæ— æ³•ä¿®æ”¹ï¼‰
class LegacyLogger {
    public void log(String level, String message) {
        System.out.println("[" + level + "] " + message);
    }
}

// é€‚é…å™¨
class LegacyLoggerAdapter implements Logger {
    private final LegacyLogger legacyLogger;

    public LegacyLoggerAdapter(LegacyLogger logger) {
        this.legacyLogger = logger;
    }

    @Override
    public void info(String message) {
        legacyLogger.log("INFO", message);
    }

    @Override
    public void error(String message) {
        legacyLogger.log("ERROR", message);
    }
}
```

é€‚é…å™¨æ¨¡å¼çš„æ ¸å¿ƒæ˜¯**é€‚é…å™¨ç±»**ï¼Œå®ƒå°†ç¬¬ä¸‰æ–¹ç±»é€‚é…ä¸ºç¬¦åˆç›®æ ‡æ¥å£çš„ç±»ã€‚é€šè¿‡ç»„åˆç°æœ‰çš„ç±»ï¼Œå®ç°å¯¹åº”çš„è¦æ±‚çš„æ¥å£ã€‚

### UML ç±»å›¾

```mermaid
classDiagram
    class Logger {
        +info(String)
        +error(String)
    }

    class LegacyLogger {
        +log(String, String)
    }

    class LegacyLoggerAdapter {
        -legacyLogger: LegacyLogger
        +info(String)
        +error(String)
    }

    LegacyLoggerAdapter --> LegacyLogger : uses
    Logger <|-- LegacyLoggerAdapter
```

### é€‚ç”¨åœºæ™¯

- é›†æˆç¬¬ä¸‰æ–¹åº“æˆ–é—ç•™ç³»ç»Ÿ
- ç»Ÿä¸€å¤šä¸ªä¸å…¼å®¹æ¥å£
- ä¸ºæµ‹è¯•æä¾› Mock é€‚é…å™¨ï¼ˆå¦‚å°† `FileReader` é€‚é…ä¸º `InputStream`ï¼‰

### æ³¨æ„äº‹é¡¹

- é€‚é…å™¨ä¸åº”æ”¹å˜è¢«é€‚é…å¯¹è±¡çš„è¡Œä¸ºï¼Œä»…åšæ¥å£è½¬æ¢ã€‚
- é¿å…è¿‡åº¦ä½¿ç”¨é€‚é…å™¨å¯¼è‡´ç³»ç»Ÿå¤æ‚åŒ–ã€‚

---

## 5.2 æ¡¥æ¥æ¨¡å¼ï¼ˆBridgeï¼‰

### å®šä¹‰

å°†**æŠ½è±¡ï¼ˆAbstractionï¼‰ä¸å®ç°ï¼ˆImplementationï¼‰åˆ†ç¦»**ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦æ¡¥æ¥ï¼Ÿ

å½“ä¸€ä¸ªç±»æœ‰å¤šä¸ªç»´åº¦çš„å˜åŒ–ï¼ˆå¦‚â€œè®¾å¤‡ç±»å‹â€ Ã— â€œæ“ä½œç³»ç»Ÿâ€ï¼‰ï¼Œä½¿ç”¨ç»§æ‰¿ä¼šå¯¼è‡´ç±»çˆ†ç‚¸ï¼ˆ`WindowsLaptop`, `MacLaptop`, `WindowsTablet`, `MacTablet`...ï¼‰ã€‚

æ¡¥æ¥æ¨¡å¼é€šè¿‡**ç»„åˆä»£æ›¿ç»§æ‰¿**ï¼Œè§£è€¦è¿™ä¸¤ä¸ªç»´åº¦ã€‚

### Java ç¤ºä¾‹

```java
// å®ç°ç»´åº¦ï¼šæ“ä½œç³»ç»Ÿ
interface OS {
    void drawWindow();
    void playSound();
}

class WindowsOS implements OS {
    public void drawWindow() { System.out.println("Windows style window"); }
    public void playSound() { System.out.println("Windows sound"); }
}

class MacOS implements OS {
    public void drawWindow() { System.out.println("Mac style window"); }
    public void playSound() { System.out.println("Mac sound"); }
}

// æŠ½è±¡ç»´åº¦ï¼šè®¾å¤‡
abstract class Device {
    protected OS os;

    public Device(OS os) {
        this.os = os;
    }

    public abstract void boot();
}

class Laptop extends Device {
    public Laptop(OS os) { super(os); }

    public void boot() {
        System.out.println("Booting laptop...");
        os.drawWindow();
        os.playSound();
    }
}

class Tablet extends Device {
    public Tablet(OS os) { super(os); }

    public void boot() {
        System.out.println("Booting tablet...");
        os.drawWindow();
    }
}
```

æ¡¥æ¥æ¨¡å¼çš„æ ¸å¿ƒåœ¨äºå°†`Abstraction`ï¼ˆæŠ½è±¡ï¼‰ ä¸ `Implementor`ï¼ˆå®ç°è€…ï¼‰ åˆ†ç¦»ã€‚

åœ¨æœ¬ä¾‹ä¸­ï¼Œ`Device` åŠå…¶å­ç±»æ„æˆ æŠ½è±¡å±‚ï¼Œè´Ÿè´£é«˜å±‚é€»è¾‘ï¼ˆå¦‚ boot()ï¼‰ï¼›
`OS` åŠå…¶å­ç±»æ„æˆ å®ç°å±‚ï¼Œè´Ÿè´£åº•å±‚å¹³å°ç›¸å…³æ“ä½œã€‚

æŠ½è±¡å±‚é€šè¿‡ç»„åˆæŒæœ‰å®ç°å±‚çš„å¼•ç”¨ï¼Œä»è€Œè§£è€¦ä¸¤è€…çš„æ¼”åŒ–ã€‚

### UML ç±»å›¾

```mermaid
classDiagram
    class Device {
        -os: OS
        +boot()
    }

    class Laptop {
        +boot()
    }

    class Tablet {
        +boot()
    }

    class OS {
        +drawWindow()
        +playSound()
    }

    class WindowsOS {
        +drawWindow()
        +playSound()
    }

    class MacOS {
        +drawWindow()
        +playSound()
    }

    Device <|-- Laptop
    Device <|-- Tablet
    Device --> OS : has-a
    OS <|-- WindowsOS
    OS <|-- MacOS
```

### ä¼˜ç‚¹

- é¿å…ç±»çˆ†ç‚¸ï¼ˆç»„åˆæ¯”ç»§æ‰¿æ›´çµæ´»ï¼‰
- æŠ½è±¡ä¸å®ç°å¯ç‹¬ç«‹æ‰©å±•
- è¿è¡Œæ—¶å¯åŠ¨æ€åˆ‡æ¢å®ç°ï¼ˆå¦‚ `device.setOS(new MacOS())`ï¼‰

### ä¸é€‚é…å™¨æ¨¡å¼çš„åŒºåˆ«

| æ¨¡å¼ | ç›®çš„ | æ—¶æœº |
|------|------|------|
| **é€‚é…å™¨** | **ä¿®å¤ä¸å…¼å®¹æ¥å£** | äº‹åè¡¥æ•‘ï¼ˆå·²æœ‰ç±»æ— æ³•ä¿®æ”¹ï¼‰ |
| **æ¡¥æ¥** | **é¢„å…ˆè§£è€¦å¤šç»´å˜åŒ–** | è®¾è®¡é˜¶æ®µä¸»åŠ¨åˆ†ç¦»å…³æ³¨ç‚¹ |

---

## 5.3 ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰

### å®šä¹‰

å°†å¯¹è±¡ç»„åˆæˆ**æ ‘å½¢ç»“æ„**ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡å…³ç³»ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚

### æ ¸å¿ƒæ€æƒ³

> â€œè®©æ ‘çš„å¶å­å’Œåˆ†æ”¯çœ‹èµ·æ¥ä¸€æ ·ã€‚â€

### Java ç¤ºä¾‹ï¼šæ–‡ä»¶ç³»ç»Ÿ

```java
// ç»„ä»¶æ¥å£
interface FileSystemItem {
    void print(String indent);
    long getSize();
}

// å¶å­èŠ‚ç‚¹ï¼šæ–‡ä»¶
class File implements FileSystemItem {
    private String name;
    private long size;

    public File(String name, long size) {
        this.name = name;
        this.size = size;
    }

    @Override
    public void print(String indent) {
        System.out.println(indent + "ğŸ“„ " + name + " (" + size + "KB)");
    }

    @Override
    public long getSize() {
        return size;
    }
}

// å®¹å™¨èŠ‚ç‚¹ï¼šæ–‡ä»¶å¤¹
class Folder implements FileSystemItem {
    private String name;
    private List<FileSystemItem> children = new ArrayList<>();

    public Folder(String name) {
        this.name = name;
    }

    public void add(FileSystemItem item) {
        children.add(item);
    }

    @Override
    public void print(String indent) {
        System.out.println(indent + "ğŸ“ " + name);
        for (FileSystemItem child : children) {
            child.print(indent + "  ");
        }
    }

    @Override
    public long getSize() {
        return children.stream().mapToLong(FileSystemItem::getSize).sum();
    }
}
```

### ä½¿ç”¨

```java
Folder root = new Folder("root");
root.add(new File("a.txt", 10));
Folder docs = new Folder("docs");
docs.add(new File("note.md", 5));
root.add(docs);
root.print("");
```

åœ¨ç»„åˆæ¨¡å¼ä¸­ï¼Œ**å¶å­èŠ‚ç‚¹**ï¼ˆå¦‚ `File`ï¼‰å’Œ**å®¹å™¨èŠ‚ç‚¹**ï¼ˆå¦‚ `Folder`ï¼‰éƒ½å®ç°äº†ç›¸åŒçš„æ¥å£ `FileSystemItem`ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥é€æ˜åœ°å¤„ç†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ã€‚

### UML ç±»å›¾

```mermaid
classDiagram
    class FileSystemItem {
        +print(String)
        +getSize(): long
    }

    class File {
        -name: String
        -size: long
        +print(String)
        +getSize(): long
    }

    class Folder {
        -name: String
        -children: List~FileSystemItem~
        +add(FileSystemItem)
        +print(String)
        +getSize(): long
    }

    FileSystemItem <|-- File
    FileSystemItem <|-- Folder
    Folder --> FileSystemItem : has-many
```

### é€‚ç”¨åœºæ™¯

- æ ‘å½¢èœå•ã€ç»„ç»‡æ¶æ„
- XML/HTML DOM ç»“æ„
- å›¾å½¢ç•Œé¢ç»„ä»¶ï¼ˆå¦‚ Swing ä¸­çš„ `Container`ï¼‰

### æ³¨æ„äº‹é¡¹

- æ‰€æœ‰ç»„ä»¶åº”æœ‰ç»Ÿä¸€æ¥å£ï¼Œä½†å¶å­èŠ‚ç‚¹çš„æŸäº›æ“ä½œï¼ˆå¦‚ `add()`ï¼‰å¯èƒ½æ— æ„ä¹‰ â†’ å¯æŠ› `UnsupportedOperationException`ã€‚
- é¿å…åœ¨å¶å­ç±»ä¸­å®ç°å®¹å™¨æ–¹æ³•ã€‚

---

## 5.4 è£…é¥°æ¨¡å¼ï¼ˆDecoratorï¼‰

### å®šä¹‰

**åŠ¨æ€åœ°**ç»™å¯¹è±¡æ·»åŠ æ–°çš„èŒè´£ï¼ˆåŠŸèƒ½ï¼‰ï¼Œè€Œä¸æ”¹å˜å…¶åŸæœ‰ä»£ç ã€‚

### æ ¸å¿ƒæ€æƒ³

> â€œç”¨åŒ…è£…ä»£æ›¿ç»§æ‰¿ã€‚â€

### ä¸ç»§æ‰¿å¯¹æ¯”

- ç»§æ‰¿ï¼š**é™æ€**ï¼Œç¼–è¯‘æœŸå†³å®šåŠŸèƒ½
- è£…é¥°ï¼š**åŠ¨æ€**ï¼Œè¿è¡Œæ—¶ç»„åˆåŠŸèƒ½

### Java ç¤ºä¾‹ï¼šå’–å•¡åŠ æ–™

```java
// åŸºç¡€ç»„ä»¶
interface Coffee {
    String getDescription();
    double cost();
}

// å…·ä½“ç»„ä»¶
class SimpleCoffee implements Coffee {
    public String getDescription() { return "Simple Coffee"; }
    public double cost() { return 2.0; }
}

// è£…é¥°å™¨åŸºç±»
abstract class CoffeeDecorator implements Coffee {
    protected Coffee decoratedCoffee;

    public CoffeeDecorator(Coffee coffee) {
        this.decoratedCoffee = coffee;
    }

    public String getDescription() {
        return decoratedCoffee.getDescription();
    }

    public double cost() {
        return decoratedCoffee.cost();
    }
}

// å…·ä½“è£…é¥°å™¨
class MilkDecorator extends CoffeeDecorator {
    public MilkDecorator(Coffee coffee) {
        super(coffee);
    }

    @Override
    public String getDescription() {
        return decoratedCoffee.getDescription() + ", Milk";
    }

    @Override
    public double cost() {
        return decoratedCoffee.cost() + 0.5;
    }
}

class SugarDecorator extends CoffeeDecorator {
    public SugarDecorator(Coffee coffee) {
        super(coffee);
    }

    @Override
    public String getDescription() {
        return decoratedCoffee.getDescription() + ", Sugar";
    }

    @Override
    public double cost() {
        return decoratedCoffee.cost() + 0.2;
    }
}
```

### ä½¿ç”¨

```java
Coffee coffee = new SimpleCoffee();
coffee = new MilkDecorator(coffee);
coffee = new SugarDecorator(coffee);
System.out.println(coffee.getDescription() + " $" + coffee.cost());
// è¾“å‡º: Simple Coffee, Milk, Sugar $2.7
```

### UML ç±»å›¾

```mermaid
classDiagram
    class Coffee {
        +getDescription(): String
        +cost(): double
    }

    class SimpleCoffee {
        +getDescription(): String
        +cost(): double
    }

    class CoffeeDecorator {
        -decoratedCoffee: Coffee
        +getDescription(): String
        +cost(): double
    }

    class MilkDecorator {
        +getDescription(): String
        +cost(): double
    }

    class SugarDecorator {
        +getDescription(): String
        +cost(): double
    }

    Coffee <|-- SimpleCoffee
    Coffee <|-- CoffeeDecorator
    CoffeeDecorator <|-- MilkDecorator
    CoffeeDecorator <|-- SugarDecorator
    CoffeeDecorator --> Coffee : wraps
```

### ä¼˜ç‚¹

- åŠŸèƒ½å¯åŠ¨æ€ç»„åˆï¼ˆå¦‚ `new CompressedInputStream(new BufferedInputStream(file))`ï¼‰
- é¿å…å¤§é‡å­ç±»ï¼ˆå¦‚ `MilkSugarCoffee`, `MilkWhippedCreamCoffee`...ï¼‰
- ç¬¦åˆå¼€é—­åŸåˆ™

### è¿è¡Œæ—¶ç»„åˆåŠŸèƒ½çš„è°ƒç”¨æ ˆ

```plaintext
coffee.cost()
 â””â”€ SugarDecorator.cost()
     â””â”€ MilkDecorator.cost()
         â””â”€ SimpleCoffee.cost() â†’ returns 2.0
     â†’ returns 2.0 + 0.5 = 2.5
 â†’ returns 2.5 + 0.2 = 2.7
```

æ¯ä¸€å±‚çš„åŒ…è£…å±‚ä¼šè°ƒç”¨ä¸‹ä¸€å±‚çš„ `cost()` æ–¹æ³•ï¼Œå¹¶è¿”å›ç»“æœã€‚

### å…¸å‹åº”ç”¨

- Java I/O æµï¼ˆ`BufferedInputStream`, `DataInputStream` ç­‰ï¼‰
- Web æ¡†æ¶ä¸­çš„ä¸­é—´ä»¶ï¼ˆå¦‚ Express.jsã€Koaï¼‰
- æƒé™ã€æ—¥å¿—ã€ç¼“å­˜ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹

---

## å°ç»“å¯¹æ¯”è¡¨

| æ¨¡å¼ | æ ¸å¿ƒç›®çš„ | å…³é”®æŠ€å·§ | å…¸å‹åœºæ™¯ |
|------|--------|--------|--------|
| é€‚é…å™¨ | **æ¥å£è½¬æ¢** | åŒ…è£…ä¸å…¼å®¹ç±» | é›†æˆç¬¬ä¸‰æ–¹åº“ |
| æ¡¥æ¥ | **è§£è€¦å¤šç»´å˜åŒ–** | æŠ½è±¡ + å®ç°åˆ†ç¦» | è·¨å¹³å°è®¾å¤‡ã€å›¾å½¢åº“ |
| ç»„åˆ | **ç»Ÿä¸€éƒ¨åˆ†ä¸æ•´ä½“** | æ ‘å½¢ç»“æ„ + ç»Ÿä¸€æ¥å£ | æ–‡ä»¶ç³»ç»Ÿã€èœå• |
| è£…é¥° | **åŠ¨æ€æ·»åŠ èŒè´£** | åŒ…è£… + å§”æ‰˜ | I/O æµã€åŠŸèƒ½å¢å¼º |

> **è®¾è®¡å“²å­¦**ï¼šç»“æ„å‹æ¨¡å¼çš„æ ¸å¿ƒæ˜¯â€œ**ç”¨ç»„åˆä»£æ›¿ç»§æ‰¿ï¼Œç”¨æ¥å£ç»Ÿä¸€å·®å¼‚**â€ï¼Œåœ¨ä¿æŒçµæ´»æ€§çš„åŒæ—¶æ„å»ºæ¸…æ™°çš„ç³»ç»Ÿç»“æ„ã€‚
