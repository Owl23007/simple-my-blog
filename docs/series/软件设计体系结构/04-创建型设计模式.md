---
title: ç¬¬å››ç«  åˆ›å»ºå‹è®¾è®¡æ¨¡å¼
date: 2025-11-19
description: è¯¦ç»†ä»‹ç»åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼ŒåŒ…æ‹¬å•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼å’ŒåŸå‹æ¨¡å¼ã€‚
outline: 2
prev:
  text: 'ç¬¬ä¸‰ç«  UML åŸºç¡€ä¸å»ºæ¨¡å®è·µ'
  link: '/series/è½¯ä»¶è®¾è®¡ä½“ç³»ç»“æ„/03-UMLåŸºç¡€ä¸å»ºæ¨¡å®è·µ'
next:
  text: 'ç¬¬äº”ç«  ç»“æ„å‹è®¾è®¡æ¨¡å¼'
  link: '/series/è½¯ä»¶è®¾è®¡ä½“ç³»ç»“æ„/05-ç»“æ„å‹è®¾è®¡æ¨¡å¼'
---

# ç¬¬å››ç«  åˆ›å»ºå‹è®¾è®¡æ¨¡å¼

åˆ›å»ºå‹è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯**å°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»**ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚GoFï¼ˆGang of Fourï¼‰å®šä¹‰äº†ä»¥ä¸‹äº”ç§åˆ›å»ºå‹æ¨¡å¼ï¼š

- å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰
- å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰
- æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰
- å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰
- åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰

---

## 4.1 å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰

### å®šä¹‰

ç¡®ä¿ä¸€ä¸ªç±»**åªæœ‰ä¸€ä¸ªå®ä¾‹**ï¼Œå¹¶æä¾›ä¸€ä¸ª**å…¨å±€è®¿é—®ç‚¹**ã€‚

### å…³é”®ç‚¹

- ç§æœ‰æ„é€ å‡½æ•°ï¼ˆé˜²æ­¢å¤–éƒ¨ `new`ï¼‰
- é™æ€ç§æœ‰å®ä¾‹
- å…¬å…±é™æ€è·å–æ–¹æ³•ï¼ˆ`getInstance()`ï¼‰

---

### ä¸¤ç§ç»å…¸å®ç°æ–¹å¼ï¼šæ‡’æ±‰å¼ vs é¥¿æ±‰å¼

| ç‰¹æ€§         | é¥¿æ±‰å¼ï¼ˆEagerï¼‰          | æ‡’æ±‰å¼ï¼ˆLazyï¼‰                |
|--------------|--------------------------|-------------------------------|
| åˆå§‹åŒ–æ—¶æœº   | ç±»åŠ è½½æ—¶ç«‹å³åˆ›å»ºå®ä¾‹     | ç¬¬ä¸€æ¬¡è°ƒç”¨ `getInstance()` æ—¶åˆ›å»º |
| çº¿ç¨‹å®‰å…¨     | å¤©ç„¶çº¿ç¨‹å®‰å…¨             | éœ€é¢å¤–åŒæ­¥æœºåˆ¶                |
| èµ„æºå ç”¨     | å¯åŠ¨å³å ç”¨å†…å­˜ï¼ˆå¯èƒ½æµªè´¹ï¼‰| æŒ‰éœ€åˆ›å»ºï¼ŒèŠ‚çœèµ„æº            |
| é€‚ç”¨åœºæ™¯     | å®ä¾‹åˆ›å»ºå¼€é”€å°ã€ä¸€å®šä¼šç”¨åˆ°| å®ä¾‹åˆ›å»ºå¼€é”€å¤§ã€å¯èƒ½ä¸ç”¨      |

#### 1. é¥¿æ±‰å¼ï¼ˆEager Initializationï¼‰

```java
public class Logger {
    // ç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹
    private static final Logger instance = new Logger();

    private Logger() {}

    public static Logger getInstance() {
        return instance;
    }
}
```

> âœ… ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œå¤©ç„¶çº¿ç¨‹å®‰å…¨
>
> âŒ ç¼ºç‚¹ï¼šæ— æ³•å»¶è¿ŸåŠ è½½ï¼Œå¯èƒ½é€ æˆèµ„æºæµªè´¹

#### 2. æ‡’æ±‰å¼ï¼ˆLazy Initializationï¼Œçº¿ç¨‹å®‰å…¨ç‰ˆï¼‰

```java
public class Logger {
    private static volatile Logger instance;

    private Logger() {}

    public static Logger getInstance() {
        if (instance == null) {  // ç¬¬ä¸€æ¬¡åˆ¤æ–­ â€”â€” å¿«é€Ÿï¼Œæ— é”
            synchronized (Logger.class) {
                if (instance == null) { // ç¬¬äºŒæ¬¡åˆ¤æ–­ â€”â€” ä¿è¯å”¯ä¸€
                    instance = new Logger();
                }
            }
        }
        return instance;
    }
}
```

> [!TIP] ä¸ºä»€ä¹ˆéœ€è¦ volatileï¼Ÿ
>
> - é˜²æ­¢ JVM æŒ‡ä»¤é‡æ’åºå¯¼è‡´å…¶ä»–çº¿ç¨‹è·å–åˆ°**æœªå®Œå…¨åˆå§‹åŒ–çš„å¯¹è±¡**ã€‚
> - ä¿è¯å¤šçº¿ç¨‹é—´å¯¹ `instance` çš„**å†™å…¥å¯è§æ€§**ã€‚

#### æ›´ä¼˜æ›¿ä»£æ–¹æ¡ˆï¼šé™æ€å†…éƒ¨ç±»

```java
public class Logger {
    private Logger() {}

    private static class Holder {
        static final Logger INSTANCE = new Logger();
    }

    public static Logger getInstance() {
        return Holder.INSTANCE;
    }
}
```

> åˆ©ç”¨ JVM ç±»åŠ è½½æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸”åªæœ‰é¦–æ¬¡è°ƒç”¨æ—¶æ‰åˆå§‹åŒ– â€”â€” **æ‡’åŠ è½½ + çº¿ç¨‹å®‰å…¨ + æ— é”**ã€‚

### é€‚ç”¨åœºæ™¯

- æ—¥å¿—è®°å½•å™¨
- é…ç½®ç®¡ç†å™¨
- çº¿ç¨‹æ± ã€ç¼“å­˜ã€æ³¨å†Œè¡¨ç­‰å…¨å±€èµ„æº

### æ³¨æ„äº‹é¡¹

> å•ä¾‹æ˜¯**å…¨å±€çŠ¶æ€**ï¼Œä¼šé™ä½ä»£ç å¯æµ‹è¯•æ€§ï¼Œå»ºè®®åœ¨ç°ä»£æ¡†æ¶ä¸­é€šè¿‡**ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰**ç®¡ç†ã€‚
>
> è­¦æƒ•**åå°„**å’Œ**ååºåˆ—åŒ–**å¯¹å•ä¾‹çš„ç ´åï¼š
>
> - åå°„å¯é€šè¿‡ `setAccessible(true)` è°ƒç”¨ç§æœ‰æ„é€ å‡½æ•° â†’ å¯åœ¨æ„é€ å‡½æ•°ä¸­æŠ›å¼‚å¸¸é˜²å¾¡ã€‚
> - ååºåˆ—åŒ–å¯é€šè¿‡å®ç° `readResolve()` æ–¹æ³•è¿”å›å”¯ä¸€å®ä¾‹ï¼š

```java
private Object readResolve() {
    return getInstance();
}
```

### å•ä¾‹æ¨¡å¼çš„ UML è¡¨ç¤º

```mermaid
classDiagram
    class Singleton {
        -instance: Singleton
        +getInstance(): Singleton
    }
```

---

## 4.2 å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰

### ç›®æ ‡

å°†å¯¹è±¡çš„åˆ›å»ºé€»è¾‘å°è£…èµ·æ¥ï¼Œå®¢æˆ·ç«¯æ— éœ€å…³å¿ƒå…·ä½“ç±»ï¼Œä»…ä¾èµ–æŠ½è±¡æ¥å£ã€‚

### ä¸‰ç§å˜ä½“

#### 1. ç®€å•å·¥å‚ï¼ˆSimple Factoryï¼‰

- **é GoF æ¨¡å¼**ï¼Œä½†å®ç”¨
- ç”±ä¸€ä¸ªå·¥å‚ç±»æ ¹æ®å‚æ•°å†³å®šåˆ›å»ºå“ªä¸ªäº§å“
- **è¿åå¼€é—­åŸåˆ™**ï¼ˆæ–°å¢äº§å“éœ€ä¿®æ”¹å·¥å‚ï¼‰

```java
public class ShapeFactory {
    public static Shape createShape(String type) {
        if (type == null || type.trim().isEmpty()) {
            throw new IllegalArgumentException("Shape type cannot be null or empty");
        }
        switch (type.trim().toLowerCase()) {
            case "circle":
                return new Circle();
            case "rect":
            case "rectangle":
                return new Rectangle();
            default:
                throw new IllegalArgumentException("Unknown shape type: " + type);
        }
    }
}
```

##### UML è¡¨ç¤º

```mermaid
classDiagram

    class Shape {
        +render(): void
    }
    class Circle {
        +radius: double
        +render(): void
    }
    class Rectangle {
        +width: double
        +height: double
        +render(): void
    }
    class ShapeFactory {
        +createShape(type: String): Shape
    }
    ShapeFactory ..> Shape : creates
    Shape <|-- Circle
    Shape <|-- Rectangle
```

`ShapeFactory` çš„è¿”å›ç±»å‹ä¸º `Shape`ï¼Œç±»é—´å…³ç³»ä¸º**ä¾èµ–**ã€‚

`Circle` å’Œ `Rectangle` ç»§æ‰¿è‡ª `Shape`ï¼Œç±»é—´å…³ç³»ä¸º**ç»§æ‰¿**ã€‚
> ğŸ§© **è®¾è®¡æ€æƒ³**ï¼š
>
> - å®¢æˆ·ç«¯åªä¾èµ– `Shape` æ¥å£ï¼Œç¬¦åˆ**ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰**ã€‚
> - ä½†æ–°å¢å½¢çŠ¶éœ€ä¿®æ”¹ `ShapeFactory`ï¼Œ**ä¸æ»¡è¶³å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰**ã€‚

#### 2. å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰

- å®šä¹‰ä¸€ä¸ª**åˆ›å»ºå¯¹è±¡çš„æ¥å£**ï¼Œç”±å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»
- **ç¬¦åˆå¼€é—­åŸåˆ™**ï¼šæ–°å¢äº§å“åªéœ€æ–°å¢å…·ä½“å·¥å‚å’Œäº§å“ç±»

```java
interface ShapeFactory {
    Shape create();
}

class CircleFactory implements ShapeFactory {
    public Shape create() { return new Circle(); }
}

class RectangleFactory implements ShapeFactory {
    public Shape create() { return new Rectangle(); }
}

// æ‰©å±•ï¼šæ–°å¢ä¸€ä¸ª Triangle å·¥å‚
class TriangleFactory implements ShapeFactory {
    public Shape create() { return new Triangle(); }
}
```

##### UML è¡¨ç¤º

```mermaid
classDiagram
    class ShapeFactory {
        +create(): Shape
    }
    class CircleFactory {
        +create(): Circle
    }
    class RectangleFactory {
        +create(): Rectangle
    }
    class TriangleFactory {
        +create(): Triangle
    }
    ShapeFactory <|.. CircleFactory
    ShapeFactory <|.. RectangleFactory
    ShapeFactory <|.. TriangleFactory:æ–°å¢
```

> ğŸ§© **è®¾è®¡æ€æƒ³**ï¼š
>
> - å·¥å‚æ–¹æ³•æ¨¡å¼é€šè¿‡å¼•å…¥å·¥å‚æ¥å£ï¼Œé¿å…äº†ç®€å•å·¥å‚çš„å•ä¸€èŒè´£é—®é¢˜ã€‚
> - æ¯ä¸ªå…·ä½“å·¥å‚ç±»åªè´Ÿè´£åˆ›å»ºä¸€ç§äº§å“ï¼Œç¬¦åˆ**å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰**ã€‚
> - æ–°å¢äº§å“æ—¶ï¼Œåªéœ€æ–°å¢å…·ä½“å·¥å‚ç±»å’Œäº§å“ç±»ï¼Œç¬¦åˆ**å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰**ã€‚

ä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ï¼Œåœ¨æ–¹æ³•å·¥å‚ä¸­ï¼Œ**æ¯ä¸ªå·¥å‚æ–¹æ³•è¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªäº§å“ç±»å‹**ï¼Œä½†æ¯å½“æˆ‘éœ€è¦æ‰©å±•æ–°çš„äº§å“æ—¶ï¼Œéƒ½éœ€è¦æ–°å¢ä¸€ä¸ªå¯¹åº”çš„å·¥å‚ç±»ï¼Œå¯¼è‡´å·¥å‚ç±»æ•°é‡æ¿€å¢ï¼Œå¢åŠ äº†ç³»ç»Ÿå¤æ‚åº¦ã€‚

#### 3. æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰

> [!TIP] æ€è€ƒä¸€ä¸‹
> ç„¶è€Œï¼Œå½“æˆ‘ä»¬é¢å¯¹çš„ä¸æ˜¯å•ä¸€äº§å“ï¼Œè€Œæ˜¯ä¸€ç»„ç›¸äº’å…³è”æˆ–ä¾èµ–çš„äº§å“ï¼ˆä¾‹å¦‚ï¼šæŒ‰é’® + å¤é€‰æ¡† + æ–‡æœ¬æ¡†å…±åŒæ„æˆä¸€å¥— UI é£æ ¼ï¼‰ï¼Œå·¥å‚æ–¹æ³•å°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒâ€”â€”æˆ‘ä»¬éœ€è¦ä¸ºæ¯ç§äº§å“åˆ†åˆ«åˆ›å»º WinButtonFactoryã€WinCheckboxFactoryã€MacButtonFactoryã€MacCheckboxFactoryâ€¦â€¦è¿™ä¸ä»…å†—ä½™ï¼Œè¿˜éš¾ä»¥ä¿è¯è¿™äº›ç»„ä»¶å±äºåŒä¸€é£æ ¼æ—ã€‚
>
>ä¸ºäº†è§£å†³â€œäº§å“æ—â€çš„åˆ›å»ºé—®é¢˜ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å°†å¤šä¸ªç›¸å…³äº§å“çš„å·¥å‚æ–¹æ³•èšåˆåˆ°åŒä¸€ä¸ªå·¥å‚æ¥å£ä¸­ï¼Œå½¢æˆä¸€ä¸ªèƒ½åˆ›å»ºä¸€æ•´å¥—ååŒå¯¹è±¡çš„å·¥å‚ â€”â€” è¿™å°±æ˜¯ æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰ã€‚

- åˆ›å»º**ä¸€ç»„ç›¸å…³æˆ–ä¾èµ–å¯¹è±¡**çš„å®¶æ—ï¼Œè€Œæ— éœ€æŒ‡å®šå…·ä½“ç±»
- é€‚ç”¨äº**äº§å“æ—**ï¼ˆå¦‚ Windows é£æ ¼ vs macOS é£æ ¼ UIï¼‰

```java
interface GUIFactory {
    Button createButton();
    Checkbox createCheckbox();
}

class WinFactory implements GUIFactory {
    public Button createButton() { return new WinButton(); }
    public Checkbox createCheckbox() { return new WinCheckbox(); }
}

class MacFactory implements GUIFactory {
    public Button createButton() { return new MacButton(); }
    public Checkbox createCheckbox() { return new MacCheckbox(); }
}

// æ‰©å±•ï¼šæ–°å¢ä¸€ä¸ª Linux é£æ ¼çš„å·¥å‚
class LinuxFactory implements GUIFactory {
    public Button createButton() { return new LinuxButton(); }
    public Checkbox createCheckbox() { return new LinuxCheckbox(); }
}
```

##### UML è¡¨ç¤º

```mermaid
classDiagram
    %% ===== æŠ½è±¡äº§å“ï¼ˆç”¨æŠ½è±¡ç±»é£æ ¼è¡¨ç¤ºæ¥å£ï¼‰=====
    class Button {
        +render(): void
    }
    class Checkbox {
        +render(): void
    }

    %% ===== å…·ä½“äº§å“ =====
    class WinButton {
        +render(): void
    }
    class MacButton {
        +render(): void
    }
    class LinuxButton {
        +render(): void
    }

    class WinCheckbox {
        +render(): void
    }
    class MacCheckbox {
        +render(): void
    }
    class LinuxCheckbox {
        +render(): void
    }

    %% ===== æŠ½è±¡å·¥å‚ï¼ˆæ¥å£ï¼‰=====
    class GUIFactory {
        +createButton(): Button
        +createCheckbox(): Checkbox
    }

    %% ===== å…·ä½“å·¥å‚ =====
    class WinFactory {
        +createButton(): Button
        +createCheckbox(): Checkbox
    }
    class MacFactory {
        +createButton(): Button
        +createCheckbox(): Checkbox
    }
    class LinuxFactory {
        +createButton(): Button
        +createCheckbox(): Checkbox
    }

    %% ===== å®ç°å…³ç³»ï¼ˆä½¿ç”¨ç»§æ‰¿ç®­å¤´è¡¨ç¤ºâ€œå®ç°â€ï¼‰=====
    Button <|-- WinButton
    Button <|-- MacButton
    Button <|-- LinuxButton

    Checkbox <|-- WinCheckbox
    Checkbox <|-- MacCheckbox
    Checkbox <|-- LinuxCheckbox

    GUIFactory <|-- WinFactory
    GUIFactory <|-- MacFactory
    GUIFactory <|-- LinuxFactory

    %% ===== ä¾èµ–å…³ç³»ï¼šå…·ä½“å·¥å‚åˆ›å»ºå…·ä½“äº§å“ =====
    WinFactory ..> WinButton : creates
    WinFactory ..> WinCheckbox : creates

    MacFactory ..> MacButton : creates
    MacFactory ..> MacCheckbox : creates

    LinuxFactory ..> LinuxButton : creates
    LinuxFactory ..> LinuxCheckbox : creates
```

> ğŸ§© **è®¾è®¡æ€æƒ³**ï¼š
>
> - æŠ½è±¡å·¥å‚æ¨¡å¼é€šè¿‡å°†å¤šä¸ªç›¸å…³äº§å“çš„åˆ›å»ºé€»è¾‘èšåˆåˆ°ä¸€ä¸ªå·¥å‚æ¥å£ä¸­ï¼Œè§£å†³äº†å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­å·¥å‚ç±»æ•°é‡æ¿€å¢çš„é—®é¢˜ã€‚
> - æ¯ä¸ªå…·ä½“å·¥å‚ç±»è´Ÿè´£åˆ›å»ºä¸€æ•´å¥—ååŒå·¥ä½œçš„äº§å“ï¼Œç¡®ä¿äº§å“ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚
> - æ–°å¢äº§å“æ—æ—¶ï¼Œåªéœ€æ–°å¢å…·ä½“å·¥å‚ç±»ï¼Œç¬¦åˆ**å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰**ã€‚

##### ä¼˜ç¼ºç‚¹

| ä¼˜ç‚¹                                   | ç¼ºç‚¹                                   |
|----------------------------------------|----------------------------------------|
| ç¡®ä¿äº§å“æ—çš„ä¸€è‡´æ€§                    | éš¾ä»¥æ”¯æŒæ–°å¢äº§å“ï¼ˆéœ€ä¿®æ”¹æ‰€æœ‰å·¥å‚ç±»ï¼‰   |
| ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œæ–°å¢äº§å“æ—æ— éœ€ä¿®æ”¹ä»£ç   | å¢åŠ äº†ç³»ç»Ÿå¤æ‚æ€§                      |
| å®¢æˆ·ç«¯ä»£ç ä¸å…·ä½“å·¥å‚è§£è€¦              |                                      |

> âš ï¸ **æ³¨æ„**ï¼š
>
> - æŠ½è±¡å·¥å‚æ¨¡å¼é€‚ç”¨äºäº§å“æ—ç¨³å®šã€å˜åŒ–è¾ƒå°‘çš„åœºæ™¯ã€‚
> - å¦‚æœäº§å“ç§ç±»é¢‘ç¹å˜åŒ–ï¼Œå¯èƒ½éœ€è¦ç»“åˆå…¶ä»–æ¨¡å¼ï¼ˆå¦‚å»ºé€ è€…æ¨¡å¼ï¼‰ä¼˜åŒ–è®¾è®¡ã€‚

### å¯¹æ¯”æ€»ç»“

| æ¨¡å¼         | çµæ´»æ€§ | æ‰©å±•æ€§ | é€‚ç”¨åœºæ™¯               |
|--------------|--------|--------|------------------------|
| ç®€å•å·¥å‚     | ä½     | å·®     | äº§å“ç§ç±»å›ºå®šã€ç®€å•åœºæ™¯ |
| å·¥å‚æ–¹æ³•     | ä¸­     | å¥½     | å•ä¸€äº§å“çº¿ã€æ’ä»¶ç³»ç»Ÿ   |
| æŠ½è±¡å·¥å‚     | é«˜     | å¥½     | å¤šäº§å“ç»„åˆï¼ˆäº§å“æ—ï¼‰   |

---

## 4.3 å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰

### å®šä¹‰

å°†ä¸€ä¸ª**å¤æ‚å¯¹è±¡çš„æ„å»ºä¸å…¶è¡¨ç¤ºåˆ†ç¦»**ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒè¡¨ç¤ºã€‚

### é€‚ç”¨åœºæ™¯

- å¯¹è±¡æœ‰å¤§é‡å¯é€‰å‚æ•°ï¼ˆå¦‚ HTTP è¯·æ±‚ã€SQL æŸ¥è¯¢ï¼‰
- æ„é€ è¿‡ç¨‹éœ€åˆ†æ­¥éª¤ã€å¯å®šåˆ¶ï¼ˆå¦‚æ¸¸æˆè§’è‰²ã€æ–‡æ¡£ç”Ÿæˆï¼‰
- éœ€è¦åˆ›å»º**ä¸å¯å˜å¯¹è±¡**

### ç»å…¸ç»“æ„ï¼ˆGoF é£æ ¼ï¼‰

```java
// äº§å“
class Pizza {
    private String dough, sauce, topping;
    // setters...
}

// æŠ½è±¡å»ºé€ è€…
abstract class PizzaBuilder {
    protected Pizza pizza;
    public Pizza getPizza() { return pizza; }
    public void createNewPizza() { pizza = new Pizza(); }
    public abstract void buildDough();
    public abstract void buildSauce();
    public abstract void buildTopping();
}

// å…·ä½“å»ºé€ è€…
class HawaiianPizzaBuilder extends PizzaBuilder {
    public void buildDough() { pizza.setDough("cross"); }
    public void buildSauce() { pizza.setSauce("mild"); }
    public void buildTopping() { pizza.setTopping("ham+pineapple"); }
}

// æŒ‡æŒ¥è€…ï¼ˆDirectorï¼‰
class Waiter {
    private PizzaBuilder builder;
    public void setBuilder(PizzaBuilder b) { builder = b; }
    public Pizza getPizza() { return builder.getPizza(); }
    public void constructPizza() {
        builder.createNewPizza();
        builder.buildDough();
        builder.buildSauce();
        builder.buildTopping();
    }
}
```

> âš ï¸ GoF ç‰ˆæœ¬é€‚ç”¨äº**æ„å»ºè¿‡ç¨‹å›ºå®šä½†è¡¨ç¤ºå¯å˜**çš„åœºæ™¯ã€‚
> å¼•å…¥ `Director`ï¼Œå®¢æˆ·ç«¯å¯ä»¥å¤ç”¨ç»Ÿä¸€çš„æ„å»ºæµç¨‹ï¼Œè€Œåªéœ€æ›´æ¢ä¸åŒçš„ `Builder` å®ç°æ¥è·å¾—ä¸åŒè¡¨ç¤ºçš„äº§å“ã€‚`Director` æœ¬èº«ä¸å†³å®šä½¿ç”¨å“ªä¸ª `Builder`ï¼Œè€Œæ˜¯ç”±å®¢æˆ·ç«¯æ³¨å…¥ã€‚â€

#### GoF å»ºé€ è€…æ¨¡å¼ç»“æ„å›¾

```mermaid
classDiagram
    class Director {
        -builder: PizzaBuilder
        +setBuilder(PizzaBuilder)
        +constructPizza()
        +getPizza(): Pizza
    }

    class PizzaBuilder {
        #pizza: Pizza
        +createNewPizza()
        +getPizza(): Pizza
        +buildDough()
        +buildSauce()
        +buildTopping()
    }

    class HawaiianPizzaBuilder {
        +buildDough()
        +buildSauce()
        +buildTopping()
    }

    class SpicyPizzaBuilder {
        +buildDough()
        +buildSauce()
        +buildTopping()
    }

    class Pizza {
        -dough: String
        -sauce: String
        -topping: String
        +setDough(String)
        +setSauce(String)
        +setTopping(String)
    }

    Director --> PizzaBuilder : uses
    PizzaBuilder <|-- HawaiianPizzaBuilder
    PizzaBuilder <|-- SpicyPizzaBuilder
    PizzaBuilder --> Pizza : constructs
```

---

### ç°ä»£ Java å®è·µï¼šæµå¼ Builderï¼ˆæ¨èï¼‰

```java
public class Pizza {
    private final String dough;
    private final String sauce;
    private final String topping;

    private Pizza(Builder builder) {
        this.dough = builder.dough;
        this.sauce = builder.sauce;
        this.topping = builder.topping;
    }

    public static class Builder {
        private String dough = "regular";
        private String sauce = "tomato";
        private String topping = "cheese";

        public Builder dough(String dough) {
            this.dough = dough;
            return this;
        }

        public Builder sauce(String sauce) {
            this.sauce = sauce;
            return this;
        }

        public Builder topping(String topping) {
            this.topping = topping;
            return this;
        }

        public Pizza build() {
            return new Pizza(this);
        }
    }
}

// ä½¿ç”¨
Pizza pizza = new Pizza.Builder()
    .dough("thin")
    .sauce("spicy")
    .topping("pepperoni")
    .build();
```

è€Œç°ä»£åŒ–çš„åˆ›å»ºæ–¹å¼ï¼Œé€šè¿‡åœ¨æ¯æ¬¡æ„å»ºæ—¶è®¾ç½®å±æ€§ï¼Œå¹¶è¿”å› `Builder` å¯¹è±¡ï¼Œæœ€åè°ƒç”¨ `build()` æ–¹æ³•åˆ›å»º `Pizza` å¯¹è±¡ã€‚

#### ç°ä»£æµå¼ Builder ç»“æ„å›¾

```mermaid
classDiagram
    class Pizza {
        -dough: String
        -sauce: String
        -topping: String
        +Pizza(Builder)
    }

    class Pizza~Builder~ {
        -dough: String
        -sauce: String
        -topping: String
        +dough(String): Builder
        +sauce(String): Builder
        +topping(String): Builder
        +build(): Pizza
    }

    Pizza --> Pizza~Builder~ : uses
    Pizza~Builder~ --> Pizza : creates
```

> ğŸ’¡ **å¯¹æ¯”è¯´æ˜**ï¼š
>
> - **GoF å»ºé€ è€…**å¼ºè°ƒâ€œæ„å»ºæµç¨‹ä¸äº§å“è§£è€¦â€ï¼Œé€‚åˆæ„å»ºæ­¥éª¤å¤æ‚ä¸”æµç¨‹å›ºå®šçš„ç³»ç»Ÿï¼ˆå¦‚æ–‡æ¡£ç”Ÿæˆå™¨ï¼‰ã€‚
> - **æµå¼ Builder**æ›´è½»é‡ï¼Œèšç„¦äºâ€œé¿å…é‡å æ„é€ å‡½æ•°â€ï¼Œå¹¿æ³›ç”¨äºç°ä»£ Javaï¼ˆå¦‚ `StringBuilder`ã€OkHttpã€Retrofit ç­‰ï¼‰ï¼Œå°¤å…¶é€‚åˆä¸å¯å˜å¯¹è±¡ã€‚

---

### ä¼˜ç‚¹

- æ„é€ è¿‡ç¨‹æ¸…æ™°å¯æ§
- é¿å…â€œé‡å æ„é€ å‡½æ•°â€åæ¨¡å¼ï¼ˆtelescoping constructorï¼‰
- æ”¯æŒä¸å¯å˜å¯¹è±¡æ„å»º
- é“¾å¼è°ƒç”¨æå‡å¯è¯»æ€§

---

## 4.4 åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰

### å®šä¹‰

é€šè¿‡**å¤åˆ¶ç°æœ‰å¯¹è±¡**æ¥åˆ›å»ºæ–°å¯¹è±¡ï¼Œè€Œä¸æ˜¯é€šè¿‡ `new`ã€‚

### é€‚ç”¨åœºæ™¯

- å¯¹è±¡åˆ›å»ºæˆæœ¬é«˜ï¼ˆå¦‚ä»æ•°æ®åº“åŠ è½½ï¼‰
- éœ€è¦åŠ¨æ€é…ç½®å¯¹è±¡æ¨¡æ¿ï¼ˆå¦‚æ¸¸æˆä¸­çš„æ•Œäººã€æŠ€èƒ½é…ç½®ï¼‰
- é¿å…å¤æ‚çš„åˆå§‹åŒ–é€»è¾‘

### Java å®ç°ï¼šå®ç° `Cloneable` æ¥å£

```java
public class Prototype implements Cloneable {
    private String name;
    private List<String> tags = new ArrayList<>();

    public Prototype(String name) {
        this.name = name;
    }

    @Override
    public Prototype clone() {
        try {
            Prototype cloned = (Prototype) super.clone();
            // æ·±æ‹·è´ï¼šé¿å…å…±äº« mutable å¯¹è±¡
            cloned.tags = new ArrayList<>(this.tags);
            return cloned;
        } catch (CloneNotSupportedException e) {
            throw new RuntimeException("Clone not supported", e);
        }
    }

    // getters/setters...
}
```

> âš ï¸ **æ³¨æ„**ï¼š`Object.clone()` é»˜è®¤æ˜¯**æµ…æ‹·è´**ï¼Œå¯¹äºåŒ…å«å¼•ç”¨ç±»å‹å­—æ®µçš„å¯¹è±¡ï¼Œéœ€æ‰‹åŠ¨å®ç°**æ·±æ‹·è´**ã€‚

---

## å°ç»“å¯¹æ¯”è¡¨

| æ¨¡å¼         | æ ¸å¿ƒæ€æƒ³                     | å…¸å‹ç”¨é€”                             |
|--------------|------------------------------|--------------------------------------|
| å•ä¾‹         | å…¨å±€å”¯ä¸€å®ä¾‹                 | æ—¥å¿—ã€é…ç½®ã€çº¿ç¨‹æ±                    |
| å·¥å‚æ–¹æ³•     | å­ç±»å†³å®šåˆ›å»ºä»€ä¹ˆ             | æ’ä»¶ç³»ç»Ÿã€å¤šæ€å¯¹è±¡åˆ›å»º               |
| æŠ½è±¡å·¥å‚     | åˆ›å»ºäº§å“æ—                   | è·¨å¹³å° UI ç»„ä»¶ã€ä¸»é¢˜ç³»ç»Ÿ             |
| å»ºé€ è€…       | åˆ†æ­¥æ„å»ºå¤æ‚å¯¹è±¡             | HTTP è¯·æ±‚ã€SQLã€ä¸å¯å˜å¯¹è±¡æ„é€        |
| åŸå‹         | å…‹éš†å·²æœ‰å¯¹è±¡                 | æ¸¸æˆå¯¹è±¡å¤åˆ¶ã€é«˜æˆæœ¬å¯¹è±¡å¤ç”¨ã€æ¨¡æ¿   |

---

> **è®¾è®¡å“²å­¦**ï¼šåˆ›å»ºå‹æ¨¡å¼çš„æœ¬è´¨ä¸æ˜¯â€œæ€ä¹ˆ new å¯¹è±¡â€ï¼Œè€Œæ˜¯â€œ**å¦‚ä½•è§£è€¦åˆ›å»ºé€»è¾‘ä¸ä½¿ç”¨é€»è¾‘**â€ï¼Œè®©ç³»ç»Ÿæ›´çµæ´»ã€æ›´æ˜“æ‰©å±•ã€‚
