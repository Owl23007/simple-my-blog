---
title: æœåŠ¡å™¨éƒ¨ç½²é…ç½®æŒ‡å—
date: 2025-11-15
description: GitHub Actions éƒ¨ç½²åˆ° Linux Ubuntu æœåŠ¡å™¨çš„é…ç½®æ­¥éª¤
---

# æœåŠ¡å™¨éƒ¨ç½²é…ç½®æŒ‡å—

> ä½¿ç”¨ GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°è‡ªå·±çš„ Linux Ubuntu æœåŠ¡å™¨ï¼Œæ”¯æŒé›¶åœæœºã€åŸå­åˆ‡æ¢å’Œè‡ªåŠ¨æ¸…ç†

## ğŸ“‹ å‰ç½®è¦æ±‚

- Linux Ubuntu æœåŠ¡å™¨ï¼ˆæ¨è 18.04 LTS æˆ–æ›´æ–°ç‰ˆæœ¬ï¼‰
- èƒ½å¤Ÿé€šè¿‡ SSH è¿æ¥åˆ°æœåŠ¡å™¨
- æœ¬åœ°å·²å®‰è£… Git å’Œ SSH å·¥å…·

## å½“å‰é…ç½®çŠ¶æ€

æœ¬é¡¹ç›®å·²é…ç½®ä»¥ä¸‹ç¯å¢ƒï¼š

- **æœåŠ¡å™¨åœ°å€**: `www.woyioii.cn`
- **æœåŠ¡å™¨ç”¨æˆ·**: `ubuntu`
- **éƒ¨ç½²ç›®å½•**: `/var/www/blog`
- **Web æœåŠ¡å™¨**: Nginx 1.24.0
- **éƒ¨ç½²æ–¹å¼**: GitHub Actions + SCP/SSH + **åŸå­è½¯é“¾æ¥åˆ‡æ¢**
- **çº¿ä¸Šç›®å½•ç»“æ„**:

  ```bash
  /var/www/blog/
  â”œâ”€â”€ dist.20251124_100000/     # è‡ªåŠ¨éƒ¨ç½²çš„ç‰ˆæœ¬ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
  â”œâ”€â”€ dist.20251123_235231/
  â””â”€â”€ current â†’ dist.20251124_100000  # è½¯é“¾æ¥ï¼ŒNginx å®é™…è¯»å–å…¥å£
  ```

## ğŸ”§ é…ç½®æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆ SSH å¯†é’¥

åœ¨æœ¬åœ°ç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼š

```bash
# åœ¨ Windows PowerShell æˆ– Linux/Mac ç»ˆç«¯ä¸­è¿è¡Œ
ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""
```

æŸ¥çœ‹ç”Ÿæˆçš„å…¬é’¥ï¼š

```bash
# æ˜¾ç¤ºå…¬é’¥å†…å®¹
cat ~/.ssh/id_rsa.pub
# æˆ–åœ¨ PowerShell ä¸­
Get-Content $HOME\.ssh\id_rsa.pub
```

### ç¬¬äºŒæ­¥ï¼šå°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨

SSH è¿æ¥åˆ°æœåŠ¡å™¨å¹¶æ·»åŠ å…¬é’¥ï¼š

```bash
# 1. è¿æ¥åˆ°æœåŠ¡å™¨
ssh ubuntu@www.woyioii.cn

# 2. åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•å¹¶æ·»åŠ å…¬é’¥
mkdir -p ~/.ssh
echo "ä½ çš„å…¬é’¥å†…å®¹" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh

# 3. é€€å‡ºæœåŠ¡å™¨
exit
```

### ç¬¬ä¸‰æ­¥ï¼šåœ¨ GitHub ä»“åº“ä¸­é…ç½® Secrets

1. è¿›å…¥ GitHub ä»“åº“
2. ç‚¹å‡» **Settings** â†’ **Secrets and variables** â†’ **Actions**
3. ç‚¹å‡» **New repository secret** æŒ‰é’®ï¼Œæ·»åŠ ä»¥ä¸‹ 5 ä¸ª Secretï¼š

| Secret åç§° | è¯´æ˜ | å·²é…ç½®å€¼ |
|-----------|------|--------|
| `SERVER_HOST` | æœåŠ¡å™¨åŸŸå | `www.woyioii.cn` |
| `SERVER_USER` | SSH ç™»å½•ç”¨æˆ· | `ubuntu` |
| `SERVER_SSH_KEY` | SSH ç§é’¥å†…å®¹ | å·²é…ç½® |
| `SERVER_PORT` | SSH ç«¯å£ | `22` |
| `SERVER_DEPLOY_PATH` | éƒ¨ç½²ç›®å½• | `/var/www/blog` |

**é‡è¦æç¤º**ï¼š

- `SERVER_SSH_KEY` æ˜¯ç§é’¥ï¼Œè¯·ä¿å¯†ï¼ä¸è¦åœ¨ä»»ä½•åœ°æ–¹å…¬å¼€åˆ†äº«
- ç¡®ä¿ç§é’¥å†…å®¹å®Œæ•´ï¼ŒåŒ…æ‹¬ `-----BEGIN OPENSSH PRIVATE KEY-----` å’Œ `-----END OPENSSH PRIVATE KEY-----` è¡Œ

### ç¬¬å››æ­¥ï¼šé…ç½®æœåŠ¡å™¨éƒ¨ç½²ç›®å½•

åˆ›å»ºéƒ¨ç½²ç›®å½•å¹¶è®¾ç½®æƒé™ï¼š

```bash
# åˆ›å»ºéƒ¨ç½²ç›®å½•
sudo mkdir -p /var/www/blog
sudo chown -R ubuntu:ubuntu /var/www/blog
sudo chmod -R 755 /var/www/blog
```

### ç¬¬äº”æ­¥ï¼šå®‰è£…å’Œé…ç½® Nginx

å®‰è£… Nginxï¼š

```bash
# æ›´æ–°åŒ…ç®¡ç†å™¨
sudo apt-get update

# å®‰è£… Nginx
sudo apt-get install -y nginx
```

åˆ›å»º Nginx è™šæ‹Ÿä¸»æœºé…ç½®ï¼š

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/blog
```

**æ·»åŠ ä»¥ä¸‹é…ç½®å†…å®¹**ï¼ˆæ³¨æ„ `root` è·¯å¾„ï¼‰ï¼š

```nginx
server {
    listen 80;
    server_name www.woyioii.cn woyioii.cn;
    root /var/www/blog/current/dist;   # â† å…³é”®ï¼šæŒ‡å‘ current/dist
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

å¯ç”¨é…ç½®å¹¶é‡æ–°åŠ è½½ Nginxï¼š

```bash
# åˆ›å»ºè½¯é“¾æ¥åˆ° sites-enabled
sudo ln -sf /etc/nginx/sites-available/blog /etc/nginx/sites-enabled/blog

# ç¦ç”¨é»˜è®¤é…ç½®ï¼ˆå¯é€‰ï¼‰
sudo rm -f /etc/nginx/sites-enabled/default

# éªŒè¯é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½ Nginx
sudo systemctl reload nginx

# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl is-active nginx
```

## å·¥ä½œæµè¯´æ˜

### GitHub Actions éƒ¨ç½²å·¥ä½œæµæ–‡ä»¶

éƒ¨ç½²å·¥ä½œæµä½äº `.github/workflows/deploy-server.yml`ï¼ŒåŒ…å«ä»¥ä¸‹é€»è¾‘ï¼š

**æ„å»ºé˜¶æ®µï¼ˆbuildï¼‰**ï¼š

- æ£€å‡ºä»£ç 
- å®‰è£… Node.js 20.x
- å®‰è£… pnpm
- å®‰è£…é¡¹ç›®ä¾èµ–
- æ„å»ºé¡¹ç›®ï¼ˆ`pnpm build`ï¼‰
- ä¸Šä¼  `./docs/.vitepress/dist` ä¸º artifact

**éƒ¨ç½²é˜¶æ®µï¼ˆdeployï¼‰**ï¼š

- ä¸‹è½½æ„å»ºäº§ç‰©åˆ° `./dist`
- é€šè¿‡ `scp-action` ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä¸´æ—¶ç›®å½•ï¼š`/var/www/blog/dist_new`
- é€šè¿‡ `ssh-action` æ‰§è¡ŒåŸå­åˆ‡æ¢è„šæœ¬ï¼š
  1. å°† `dist_new` é‡å‘½åä¸º `dist.YYYYMMDD_HHMMSS`
  2. æ›´æ–°è½¯é“¾æ¥ `current â†’ dist.æ–°æ—¶é—´æˆ³`
  3. è‡ªåŠ¨æ¸…ç†æ—§ç‰ˆæœ¬ï¼ˆä¿ç•™æœ€è¿‘ 3 ä¸ªï¼‰

**å…³é”®ä¼˜åŠ¿**ï¼š

- âœ… **é›¶åœæœºéƒ¨ç½²**ï¼šè½¯é“¾æ¥åˆ‡æ¢æ˜¯åŸå­æ“ä½œï¼ŒNginx æ— æ„ŸçŸ¥
- âœ… **è‡ªåŠ¨å›æ»š**ï¼šæ—§ç‰ˆæœ¬ä»å­˜åœ¨äºç£ç›˜ï¼Œå¯æ‰‹åŠ¨åˆ‡æ¢é“¾æ¥å›é€€
- âœ… **è‡ªåŠ¨æ¸…ç†**ï¼šé¿å…ç£ç›˜è¢«æ—§æ„å»ºå æ»¡

**è§¦å‘æ¡ä»¶**ï¼š

- æ¨é€åˆ° `master` åˆ†æ”¯æ—¶è‡ªåŠ¨è§¦å‘
- æ”¯æŒé€šè¿‡ GitHub ç½‘é¡µæ‰‹åŠ¨è§¦å‘ï¼ˆ`workflow_dispatch`ï¼‰

### ç›®å½•ç»“æ„ç¤ºä¾‹ï¼ˆéƒ¨ç½²åï¼‰

```bash
/var/www/blog/
â”œâ”€â”€ dist.20251124_100000/
â”‚   â””â”€â”€ ...ï¼ˆä½ çš„åšå®¢é™æ€æ–‡ä»¶ï¼‰
â”œâ”€â”€ dist.20251123_235231/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ current â†’ dist.20251124_100000   # â† Nginx è¯»å–æ­¤é“¾æ¥
â””â”€â”€ ...ï¼ˆæ—§ç‰ˆæœ¬è‡ªåŠ¨ä¿ç•™ï¼‰
```

## å·¥ä½œæµæµç¨‹å›¾

```mermaid
graph TD
    A["ğŸ–¥ï¸ æœ¬åœ°ä»£ç <br/>git push"] --> B["âš™ï¸ GitHub Actions<br/>deploy-server.yml"]

    B --> C["ğŸ”¨ Build é˜¶æ®µ"]
    B --> D["ğŸ“¤ Deploy é˜¶æ®µ"]

    C --> C1["Checkout ä»£ç "]
    C --> C2["Node.js 20.x"]
    C --> C3["å®‰è£… pnpm"]
    C --> C4["å®‰è£…ä¾èµ–"]
    C --> C5["æ„å»ºé¡¹ç›®"]
    C --> C6["ä¸Šä¼ äº§ç‰©"]

    D --> D1["ä¸‹è½½æ„å»ºäº§ç‰©"]
    D --> D2["SCP ä¸Šä¼ åˆ° dist_new"]
    D --> D3["SSH æ‰§è¡ŒåŸå­åˆ‡æ¢"]
    D3 --> D3a["é‡å‘½å dist_new â†’ dist.æ—¶é—´æˆ³"]
    D3 --> D3b["æ›´æ–° current è½¯é“¾æ¥"]
    D3 --> D3c["æ¸…ç†æ—§ç‰ˆæœ¬"]

    C6 --> E["ğŸ§ Ubuntu æœåŠ¡å™¨<br/>www.woyioii.cn"]
    D3 --> E

    E --> F["ğŸ“ /var/www/blog/current/dist"]
    F --> G["ğŸŒ Nginx<br/>http://www.woyioii.cn"]

    style A fill:#e1f5ff
    style B fill:#fff3e0
    style C fill:#f3e5f5
    style D fill:#f3e5f5
    style E fill:#e8f5e9
    style G fill:#c8e6c9
```

---

## éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸ

1. æŸ¥çœ‹æœåŠ¡å™¨ç›®å½•ï¼š

   ```bash
   ls -l /var/www/blog/current/dist
   ```

2. è®¿é—®ç½‘ç«™ï¼š`https://www.woyioii.cn`
3. æ£€æŸ¥ Actions æ—¥å¿—æ˜¯å¦ç»¿è‰²é€šè¿‡

> **ç›¸å…³æ–‡æ¡£**: [CICDé…ç½®](./CICDé…ç½®.md) | [åˆ†æ”¯ç­–ç•¥](./åˆ†æ”¯ç­–ç•¥.md)
