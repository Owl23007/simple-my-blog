# CI/CD é…ç½®æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†é¡¹ç›®çš„ CI/CD é…ç½®ï¼ŒåŒ…æ‹¬ GitHub Actions å·¥ä½œæµã€åˆ†æ”¯ç­–ç•¥ä»¥åŠä½¿ç”¨æ–¹æ³•ã€‚

## ğŸ“‹ ç›®å½•

- [æ¦‚è§ˆ](#-æ¦‚è§ˆ)
- [å·¥ä½œæµé…ç½®](#ï¸-å·¥ä½œæµé…ç½®)
- [åˆ†æ”¯ç­–ç•¥](#-åˆ†æ”¯ç­–ç•¥)
- [ç¯å¢ƒè®¾ç½®](#ï¸-ç¯å¢ƒè®¾ç½®)
- [ä½¿ç”¨æŒ‡å—](#-ä½¿ç”¨æŒ‡å—)
- [ç›‘æ§ä¸ç»´æŠ¤](#-ç›‘æ§ä¸ç»´æŠ¤)

## ğŸ¯ æ¦‚è§ˆ

### - æŠ€æœ¯æ ˆ

- **CI/CD å¹³å°**: GitHub Actions
- **æ„å»ºå·¥å…·**: pnpm + Node.js
- **éƒ¨ç½²ç›®æ ‡**: GitHub Pages
- **ä»£ç è´¨é‡**: TypeScript + Oxlint + ESLint

### - å·¥ä½œæµæ¶æ„

```mermaid
graph LR
    A[å¼€å‘åˆ†æ”¯] --> B[CI æ£€æŸ¥]
    B --> C{æ£€æŸ¥é€šè¿‡?}
    C -->|æ˜¯| D[åˆå¹¶åˆ°ä¸»åˆ†æ”¯]
    C -->|å¦| E[ä¿®å¤é—®é¢˜]
    E --> A
    D --> F[è‡ªåŠ¨éƒ¨ç½²]
    F --> G[çº¿ä¸Šç¯å¢ƒ]
```

## âš™ï¸ å·¥ä½œæµé…ç½®

### 1. ğŸš€ ç”Ÿäº§éƒ¨ç½²å·¥ä½œæµ (`deploy.yml`)

**ç›®æ ‡**: è‡ªåŠ¨æ„å»ºå¹¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

| é…ç½®é¡¹ | å€¼ |
|-------|-----|
| è§¦å‘æ¡ä»¶ | æ¨é€åˆ° `master` åˆ†æ”¯ |
| è¿è¡Œç¯å¢ƒ | Ubuntu Latest |
| Node.js ç‰ˆæœ¬ | 20.x |
| åŒ…ç®¡ç†å™¨ | pnpm |
| éƒ¨ç½²ç›®æ ‡ | GitHub Pages |

**æµç¨‹æ­¥éª¤**:

1. æ£€å‡ºä»£ç 
2. è®¾ç½® Node.js ç¯å¢ƒ
3. å®‰è£…ä¾èµ– (`pnpm install --frozen-lockfile`)
4. æ„å»ºé¡¹ç›® (`pnpm build`)
5. éƒ¨ç½²åˆ° GitHub Pages

**è®¿é—®åœ°å€**: <https://owl23007.github.io/simple-my-blog>

### 2. ğŸ” ä»£ç è´¨é‡æ£€æŸ¥å·¥ä½œæµ (`ci.yml`)

**ç›®æ ‡**: ç¡®ä¿ä»£ç è´¨é‡å’Œé¡¹ç›®ç¨³å®šæ€§

| é…ç½®é¡¹ | å€¼ |
|-------|-----|
| è§¦å‘æ¡ä»¶ | æ¨é€åˆ°å¼€å‘åˆ†æ”¯æˆ– PR |
| æ”¯æŒåˆ†æ”¯ | `develop`, `feature/*`, `hotfix/*`, `release/*` |
| Node.js ç‰ˆæœ¬ | 18.x, 20.x (çŸ©é˜µæ„å»º) |
| ç¼“å­˜ç­–ç•¥ | pnpm store ç¼“å­˜ |

**æ£€æŸ¥é¡¹ç›®**:

- âœ… TypeScript ç±»å‹æ£€æŸ¥
- âœ… Oxlint ä»£ç è§„èŒƒæ£€æŸ¥
- âœ… Markdown æ ¼å¼éªŒè¯
- âœ… æ„å»ºæˆåŠŸæ€§éªŒè¯
- âœ… ä¾èµ–å®‰å…¨æ‰«æ (npm audit)
- âœ… ä»£ç å®‰å…¨åˆ†æ (CodeQL)

### 3. ğŸ“¦ ç‰ˆæœ¬å‘å¸ƒå·¥ä½œæµ (`release.yml`)

**ç›®æ ‡**: è‡ªåŠ¨åŒ–ç‰ˆæœ¬å‘å¸ƒå’Œå˜æ›´æ—¥å¿—ç”Ÿæˆ

| é…ç½®é¡¹ | å€¼ |
|-------|-----|
| è§¦å‘æ¡ä»¶ | æ¨é€æ ‡ç­¾ (`v*` æ ¼å¼) |
| å‘å¸ƒå†…å®¹ | å˜æ›´æ—¥å¿— + æ„å»ºäº§ç‰© |
| å‘å¸ƒå¹³å° | GitHub Releases |

**è‡ªåŠ¨åŒ–åŠŸèƒ½**:

- ğŸ“ ç”Ÿæˆå˜æ›´æ—¥å¿—
- ğŸ·ï¸ åˆ›å»º GitHub Release
- ğŸ“ ä¸Šä¼ æ„å»ºäº§ç‰©
- ğŸ”— æä¾›ä¸‹è½½é“¾æ¥

## ğŸŒ¿ åˆ†æ”¯ç­–ç•¥

### åˆ†æ”¯æ¨¡å‹

```text
master (ç”Ÿäº§)     â† éƒ¨ç½²åˆ°çº¿ä¸Š
  â†‘
develop (å¼€å‘)    â† é›†æˆæµ‹è¯•
  â†‘
feature/* (åŠŸèƒ½)  â† åŠŸèƒ½å¼€å‘
hotfix/* (çƒ­ä¿®å¤)  â† ç´§æ€¥ä¿®å¤
release/* (å‘å¸ƒ)  â† å‘å¸ƒå‡†å¤‡
```

### å·¥ä½œæµæ˜ å°„

| åˆ†æ”¯ç±»å‹ | CI æ£€æŸ¥ | è‡ªåŠ¨éƒ¨ç½² | å‘å¸ƒç‰ˆæœ¬ |
|---------|--------|---------|----------|
| `master` | âœ… | âœ… | - |
| `develop` | âœ… | - | - |
| `feature/*` | âœ… | - | - |
| `hotfix/*` | âœ… | - | - |
| `release/*` | âœ… | - | - |
| `v*` (æ ‡ç­¾) | - | - | âœ… |

## ğŸ› ï¸ ç¯å¢ƒè®¾ç½®

### ä»“åº“æƒé™é…ç½®

ç¡®ä¿ä»¥ä¸‹è®¾ç½®å·²å¯ç”¨ï¼š

```yaml
Settings â†’ Pages:
  Source: GitHub Actions

Settings â†’ Actions â†’ General:
  Workflow permissions: Read and write permissions
  Allow GitHub Actions to create and approve pull requests: âœ…
```

### å¯é€‰çš„ Secrets é…ç½®

å¦‚éœ€æ‰©å±•åŠŸèƒ½ï¼Œå¯é…ç½®ä»¥ä¸‹ Secretsï¼š

```bash
# ç¬¬ä¸‰æ–¹éƒ¨ç½²æœåŠ¡
NETLIFY_AUTH_TOKEN=your_netlify_token
NETLIFY_SITE_ID=your_site_id

# é€šçŸ¥æœåŠ¡
SLACK_WEBHOOK=your_slack_webhook
DISCORD_WEBHOOK=your_discord_webhook
```

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# è¦æ±‚
Node.js: >= 18.0.0
pnpm: >= 8.0.0

# å®‰è£…
npm install -g pnpm
pnpm install
```

## ğŸ“š ä½¿ç”¨æŒ‡å—

### æ—¥å¸¸å¼€å‘æµç¨‹

```bash
# 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/article-optimization

# 2. å¼€å‘ä»£ç 
# ... ç¼–å†™ä»£ç  ...

# 3. æäº¤å¹¶æ¨é€
git add .
git commit -m "feat: ä¼˜åŒ–æ–‡ç« ç»“æ„"
git push origin feature/article-optimization
# â†’ è‡ªåŠ¨è§¦å‘ CI æ£€æŸ¥

# 4. åˆ›å»º Pull Request
# â†’ åœ¨ GitHub ä¸Šåˆ›å»º PR åˆ° develop åˆ†æ”¯
```

### å‘å¸ƒæµç¨‹

```bash
# æ–¹å¼1: åˆå¹¶åˆ°ä¸»åˆ†æ”¯ (è‡ªåŠ¨éƒ¨ç½²)
git checkout master
git merge develop
git push origin master
# â†’ è‡ªåŠ¨è§¦å‘ç”Ÿäº§éƒ¨ç½²

# æ–¹å¼2: åˆ›å»ºå‘å¸ƒç‰ˆæœ¬
git tag -a v1.2.0 -m "Release v1.2.0: æ–°å¢æ–‡ç« ç®¡ç†åŠŸèƒ½"
git push origin v1.2.0
# â†’ è‡ªåŠ¨è§¦å‘ç‰ˆæœ¬å‘å¸ƒ
```

### ç´§æ€¥ä¿®å¤æµç¨‹

```bash
# 1. ä» master åˆ›å»ºçƒ­ä¿®å¤åˆ†æ”¯
git checkout master
git checkout -b hotfix/critical-bug-fix

# 2. ä¿®å¤é—®é¢˜
# ... ä¿®å¤ä»£ç  ...

# 3. æ¨é€å¹¶åˆ›å»º PR
git push origin hotfix/critical-bug-fix
# â†’ åˆ›å»º PR åˆ° masterï¼Œé€šè¿‡åè‡ªåŠ¨éƒ¨ç½²
```

## ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤

### æ„å»ºçŠ¶æ€ç›‘æ§

- **å®æ—¶çŠ¶æ€**: [GitHub Actions é¡µé¢](https://github.com/Owl23007/SimpleMyInfo/actions)
- **PR æ£€æŸ¥**: Pull Request ä¼šæ˜¾ç¤ºæ‰€æœ‰æ£€æŸ¥ç»“æœ
- **é‚®ä»¶é€šçŸ¥**: æ„å»ºå¤±è´¥æ—¶è‡ªåŠ¨å‘é€é€šçŸ¥

### å¸¸è§é—®é¢˜æ’æŸ¥

#### ğŸš¨ æ„å»ºå¤±è´¥

1. **æ£€æŸ¥æ—¥å¿—**: æŸ¥çœ‹ Actions é¡µé¢çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. **æœ¬åœ°éªŒè¯**: è¿è¡Œ `pnpm build` ç¡®è®¤æœ¬åœ°æ„å»ºæ­£å¸¸
3. **ä¾èµ–é—®é¢˜**: æ£€æŸ¥ `package.json` å’Œ `pnpm-lock.yaml`
4. **ç‰ˆæœ¬å…¼å®¹**: ç¡®è®¤ Node.js ç‰ˆæœ¬å…¼å®¹æ€§

#### ğŸš¨ éƒ¨ç½²å¤±è´¥

1. **æƒé™æ£€æŸ¥**: ç¡®è®¤ GitHub Pages å’Œ Actions æƒé™
2. **æ„å»ºäº§ç‰©**: éªŒè¯ `dist` ç›®å½•æ˜¯å¦æ­£ç¡®ç”Ÿæˆ
3. **è·¯å¾„é…ç½®**: æ£€æŸ¥é™æ€èµ„æºè·¯å¾„é…ç½®

#### ğŸš¨ ä»£ç æ£€æŸ¥å¤±è´¥

```bash
# æœ¬åœ°è¿è¡Œæ£€æŸ¥å‘½ä»¤
pnpm lint           # ä»£ç è§„èŒƒæ£€æŸ¥
pnpm type-check     # ç±»å‹æ£€æŸ¥
pnpm build          # æ„å»ºéªŒè¯
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜ç­–ç•¥**:
   - âœ… å·²é…ç½® pnpm store ç¼“å­˜
   - ğŸ”„ å¯è€ƒè™‘æ·»åŠ æ„å»ºäº§ç‰©ç¼“å­˜

2. **å¹¶è¡Œä¼˜åŒ–**:
   - âœ… å¤šç‰ˆæœ¬ Node.js å¹¶è¡Œæµ‹è¯•
   - ğŸ”„ å¯å¹¶è¡Œè¿è¡Œ lint å’Œç±»å‹æ£€æŸ¥

3. **æ¡ä»¶è§¦å‘**:
   - ğŸ”„ æ ¹æ®æ–‡ä»¶å˜æ›´æ™ºèƒ½è§¦å‘ç›¸å…³æ£€æŸ¥
   - ğŸ”„ è·³è¿‡æ— å…³åˆ†æ”¯çš„é‡å¤æ£€æŸ¥

4. **ç›‘æ§æ‰©å±•**:
   - ğŸ”„ é›†æˆæ„å»ºæ—¶é—´ç›‘æ§
   - ğŸ”„ æ·»åŠ éƒ¨ç½²æ€§èƒ½æŒ‡æ ‡
   - ğŸ”„ é›†æˆ Slack/Discord é€šçŸ¥
